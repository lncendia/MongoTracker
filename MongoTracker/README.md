# MongoTracker

**MongoTracker** — это мини-ORM (Object-Relational Mapping) библиотека для работы с MongoDB, которая позволяет автоматически отслеживать изменения в сущностях и выполнять массовые операции записи в базу данных. Библиотека упрощает работу с MongoDB, предоставляя удобный интерфейс для управления сущностями и их изменениями.

## Основные возможности

1. **Отслеживание изменений**:
    - Автоматическое отслеживание изменений в сущностях (добавление, обновление, удаление).
    - Поддержка массовых операций записи (BulkWrite).
    - Возможность точечного обновления изменений в сложных документах, включая вложенные объекты и коллекции.

2. **Удобный интерфейс**:
    - Простое добавление сущностей в трекер.
    - Легкая интеграция с существующими проектами.

3. **Гибкость**:
    - Поддержка любых типов сущностей.
    - Возможность настройки идентификаторов сущностей.

4. **Производительность**:
    - Минимизация количества запросов к базе данных за счет массовых операций.
    - Точечное обновление только измененных полей, что снижает нагрузку на базу данных.

## Установка

Для использования MongoTracker в вашем проекте, добавьте его как зависимость через NuGet:

```bash
dotnet add package MongoTracker
```

## Использование

### 1. Инициализация трекера

Для начала работы с MongoTracker необходимо создать экземпляр трекера, указав тип сущности и способ получения её идентификатора.

```csharp
var mongoTracker = new MongoTracker<Guid, Book>(tk => tk.Id);
```

### 2. Добавление сущностей в трекер

Сущности можно добавлять в трекер по одной или списком. Трекер автоматически отслеживает изменения.

```csharp
var book = new Book { Id = Guid.NewGuid(), Title = "Sample Book" };
mongoTracker.Add(book);

var anotherBook = await mongoDbContext.Books
    .AsQueryable()
    .FirstOrDefaultAsync(b => b.Id = idToFind);
anotherBook = mongoTracker.Track(anotherBook);
```

### 3. Массовая запись изменений

После добавления сущностей в трекер, изменения можно записать в базу данных одной операцией.

```csharp
await mongoDbContext.Books.BulkWriteAsync(mongoTracker.Commit());
```

### 4. Точечное обновление изменений

MongoTracker позволяет отслеживать изменения даже в сложных документах, включая вложенные объекты и коллекции. При правильной настройке сущностей, библиотека автоматически определяет изменения и обновляет только те поля, которые были изменены.

Пример:

```csharp
var book = new Book
{
    Id = Guid.NewGuid(),
    Title = "Sample Book",
    Chapters = new List<BookChapter>
    {
        new BookChapter { Name = "Chapter 1", StartPage = 1, EndPage = 10 }
    }
};

mongoTracker.Add(book);

// Изменяем название главы
book.Chapters[0].Name = "Updated Chapter 1";

// Трекер автоматически отследит изменение и обновит только поле Name в коллекции Chapters.
await mongoDbContext.Books.BulkWriteAsync(mongoTracker.Commit());
```

## Пример проекта (MongoTracker.Sample)

В репозитории доступен пример проекта `MongoTracker.Sample`, который демонстрирует основные возможности библиотеки. Пример включает:

1. **Инициализацию базы данных**:
    - Создание коллекций авторов и книг.
    - Заполнение базы данных тестовыми данными.

2. **Отслеживание изменений**:
    - Добавление, обновление и удаление сущностей.
    - Массовая запись изменений в базу данных.

3. **Работу с различными типами сущностей**:
    - Авторы, книги, главы и аудиокниги.

## Лицензия

MongoTracker распространяется под лицензией MIT.

## Обратная связь

Если у вас есть вопросы, предложения или вы обнаружили ошибку, пожалуйста, создайте [issue](https://github.com/your-repo/issues) в репозитории проекта.

---

**MongoTracker** — это простой и мощный инструмент для работы с MongoDB, который поможет вам эффективно управлять данными в вашем приложении. Попробуйте его в своем проекте и убедитесь в его удобстве и производительности!